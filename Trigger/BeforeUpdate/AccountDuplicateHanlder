/* Author	- svasagar
* Date 		- 01/15/2026 -  Pongal 
* Purpose 	- Handler Class - throw error when Account got Updated & Created with duplicate name
*/


public class AccountDuplicateHanlder {
    List<Account> triggerNew;
    List<Account> triggerOld;
    Map<Id, Account> triggerNewMap;
    Map<Id, Account> triggerOldMap;
    
    public AccountDuplicateHanlder(){
        triggerNew    = (List<Account>) Trigger.New;
        triggerOld    = (List<Account>) Trigger.Old;
        triggerNewMap = (Map<Id, Account>) Trigger.NewMap;
        triggerOldMap = (Map<Id, Account>) Trigger.OldMap;
    }
    
    public void doActions(){
        Switch on Trigger.OperationType{
            When Before_Insert{
                onBeforeInsert ();
            }
            When Before_Update{
                onBeforeUpdate ();
            }}
    }
    //---------------- before Insert
    public void onBeforeInsert (){
        set<String> newName = new set<String>();
        for(Account record: triggerNew){
            newName.add(record.Name);
        }
        
        helperToThrowError(newName);
    }
    
    //----------------- before Update
    public void onBeforeUpdate(){
        set<String> updatedNames = new set<String> ();
        for(Account record: triggerNew){
            if(record.Name != triggerOldMap.get(record.Id).Name){
                updatedNames.add(record.Name);
            }
        }
        helperToThrowError(updatedNames);   
    }
	//--------------- Helper    
    public void helperToThrowError(Set<String> newName){
        List<Account> accList = [Select Name from Account where Name IN : newName];
        set<String> existingNames = new set<String> ();
        if(accList.isEmpty()){
            return;
        }
        
        // Use set to compare field values instead List, 
        // List compares whole record not individual field values
        for(Account record: accList){
            existingNames.add(record.Name);
        }
        
        // Loop thru TriggerNew to throw error
        for(Account record: triggerNew)
        {
            if(existingNames.contains(record.Name))
            {
                record.addError(' Error from Trigger: This is Existing Account Name, Please choose diff one');
            }}}
}
